// General pipeline parameters
params {
    // Output directory (can be overridden by pipeline)
    outdir = './results'
    
    // Help message
    help = false
    
    // Max resources
    max_cpus = 16
    max_memory = '128.GB'
    max_time = '5.d'
}

// Process configuration
process {
    // Default resources
    cpus = 1
    memory = 4.GB
    time = 2.h
    
    // Error handling
    errorStrategy = 'retry'
    maxRetries = 2
    
    // SLURM account
    clusterOptions = '--account=def-mcfarlas'
    
    // Process-specific resources
    withName: INDEX_REFERENCE {
        cpus = 1
        memory = 4.GB
        time = 30.m
    }
    
    withName: BCFTOOLS_MPILEUP {
        cpus = 16
        memory = 128.GB
        time = '5.d'
    }
    
    withName: BCFTOOLS_CALL_AND_FILTER {
        cpus = 8
        memory = 64.GB
        time = '2.d'
    }
}

// Executor configuration for SLURM (Compute Canada)
executor {
    name = 'slurm'
    queueSize = 10
    submitRateLimit = '10 sec'
    pollInterval = '30 sec'
}

// Profiles
profiles {
    standard {
        process.executor = 'slurm'
    }
    
    slurm {
        process.executor = 'slurm'
        process.module = 'samtools/1.22.1:bcftools/1.22'
        executor.queueSize = 10
    }
    
    local {
        process.executor = 'local'
        process.cpus = 4
        process.memory = '16.GB'
    }
}

// Manifest
manifest {
    name = 'variant-calling-bcftools'
    author = 'Seqera AI'
    description = 'Variant calling pipeline using BCFtools for Peromyscus BAM files'
    version = '1.0.0'
    nextflowVersion = '>=21.04.0'
}

// Report and trace options
timeline {
    enabled = true
    file = "${params.outdir}/reports/timeline.html"
}

report {
    enabled = true
    file = "${params.outdir}/reports/report.html"
}

trace {
    enabled = true
    file = "${params.outdir}/reports/trace.txt"
}

dag {
    enabled = true
    file = "${params.outdir}/reports/dag.svg"
}
